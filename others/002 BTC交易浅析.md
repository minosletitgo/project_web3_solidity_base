### 浅析一下用户发出交易的过程：

#### 交易创建
```
[张三]的操作：
    [张三]使用自己的比特币钱包软件，输入[王五]的比特币地址和转账金额（1 BTC）。
    钱包软件生成一笔交易，包含以下信息：
        输入：指向[张三]之前收到的比特币（UTXO，未花费交易输出）。
        输出：[王五]的比特币地址和转账金额（1 BTC）。
        手续费：[张三]可以选择支付一定的手续费，以激励矿工打包交易。
        签名：[张三]使用自己的私钥对交易进行签名，证明他拥有这些比特币。
```

#### 交易广播
```
[张三]的操作：
    [张三]的钱包软件将这笔交易广播到比特币网络。
    由于网络中有[全球所有个全节点]，交易会被传播到这些节点。
    全节点使用洪水算法（Flooding Algorithm）将交易广播给其连接的其他全节点。
    每个全节点会将交易转发给其所有邻居节点，直到交易传播到整个网络。
```

#### 交易验证
```
全节点的工作：
    [全球所有个全节点]接收到这笔交易后，会对其进行验证：
        验证签名：确认交易确实由[张三]发起。
        检查UTXO：确认[张三]的输入是有效的未花费交易输出。
        检查规则：确认交易符合比特币的共识规则（如未双花、输出金额不超过输入金额等）。
    如果交易有效，全节点会将其放入自己的内存池（mempool），等待矿工打包。
```

#### 挖矿
```
矿工的工作：
    全球所有的矿工会从内存池中收集交易，并尝试将其打包进新区块。
    每个矿工的工作流程如下：
        收集交易：从内存池中收集交易（包括[张三]转账给[王五]的这笔交易）。
            矿工从内存池中筛选出所有有效的交易。
            按照交易的手续费（单位：sat/byte 或 sat/vByte）从高到低排序。
            矿工根据区块的大小限制（目前比特币区块大小上限为 1MB 或 4MB，取决于是否使用 SegWit）选择足够数量的交易(大概4000个上下)。
            优先选择手续费高的交易，直到区块容量接近上限。
        创建区块：将选中的足量交易打包成一个候选区块，区块头中包含前一个区块的哈希值、默克尔根、时间戳等信息。
        工作量证明（PoW）：矿工不断调整Nonce值，计算区块头的哈希值，直到找到满足当前难度目标的哈希值。
            区块头 = 版本号 + 前一个区块的哈希值 + Merkle根 + 时间戳 + 难度目标 + Nonce
            Hash = SHA256(SHA256(区块头))
            Hash <= Target
            Target值：比特币网络每产生 2016 个区块（大约两周），会根据过去 2016 个区块的实际生成时间，动态调整 Target 值，以保持平均出块时间在 10 分钟 左右。
            Target = OldTarget * (过去 2016 个区块的实际生成时间)/(2016 个区块 × 10 分钟)            
        挖出区块：当某个矿工成功找到有效的Nonce值后，他会将这个新区块广播到网络。
```

#### 区块广播
```
矿工的操作：
    成功挖出新区块的矿工会将区块广播到比特币网络。
    区块会被传播到[全球所有个全节点]。
```

#### 区块验证
```
全节点的工作：
    [任意一个个全节点]接收到新区块后，会对其进行验证：
        验证区块头：检查区块头的哈希值是否满足难度目标。
        验证交易：检查区块中的所有交易是否有效。
        检查链上链接：确认新区块正确链接到前一个区块。
    如果区块有效，全节点会将其添加到本地的区块链中，并继续广播给其他节点。

出块时间(面试题)：
    约10分钟。

交易确认位(面试题)：
    通常需要6个区块，大约60分钟。

Finalized所需区块数:
    6个区块。
```

#### 交易确认
```
区块链更新：
    [张三]转账给[王五]的交易被包含在新区块中，并写入区块链。
    这笔交易现在被认为是已确认的交易。

[王五]的余额更新：
    [王五]的钱包软件会检测到这笔交易，并更新他的余额（增加1 BTC）。    
```

#### 奖励分配
```
矿工的奖励：
    成功挖出新区块的矿工会获得区块奖励（新生成的比特币）和交易手续费（如果有）。
    新生成的比特币：区块奖励初始为 50 BTC，每 210,000 个区块（约 4 年）减半一次。截至 2023 年，区块奖励为 6.25 BTC。
```

　

---------------------------------------------------------------------------------

　

### 交易示例 - 区块链浏览器的解析处理后生成
```
{
  "txid": "0627052b6f28912f2703066a912ea577f2ce4da4caa5a5fbd8a57286c345c2f2", // 交易的唯一标识（交易哈希值）
  "size": 258, // 交易的大小（以字节为单位）
  "version": 1, // 比特币协议中指定的交易版本号
  "locktime": 0, // 交易的时间锁，为0，说明交易没有时间锁限制，可以立即确认。
  "fee": 50000, // 交易费，矿工处理交易时收取的费用，单位为“聪”（1 比特币 = 100,000,000 聪 satoshi）。
  "inputs": [
    {
      // inputs 部分描述交易中用来作为支付来源的 UTXO（未花费交易输出）

      "coinbase": false, // 表示这个输入不是来自coinbase交易（即不是挖矿奖励）
      "txid": "7957a35fe64f80d234d76d83a2a8f1a0d8149a41d81de548f0a65a8a999f6f18", // 上一笔交易的哈希值，表示这笔输入引用了该笔交易的输出。
      "output": 0, // 上一笔交易中某个具体输出的索引号，此处是第 0 个输出。
      "sigscript": // 签名脚本，用于解锁上一个交易的输出，证明当前地址的所有权。"483045022100884d142d86652a3f47ba4746ec719bbfbd040a570b1deccbb6498c75c4ae24cb02204b9f039ff08df09cbe9f6addac960298cad530a863ea8f53982c09db8f6e381301410484ecc0d46f1918b30928fa0e4ed99f16a0fb4fde0735e7ade8416ab9fe423cc5412336376789d172787ec3457eee41c04f4938de5cc17b4a10fa336a8d752adf",
      "sequence": 4294967295, // 序列号，值为 4294967295，表示未启用时间锁。
      "pkscript": "76a9147f9b1a7fb68d60c536c2fd8aeaa53a8f3cc025a888ac", // 上一笔交易输出中锁定 BTC 的脚本（输出脚本）。
      "value": 10000000, // 输入的金额（单位：satoshi）：10000000（0.1 BTC）。
      "address": "1Cdid9KFAaatwczBwBttQcwXYCpvK8h7FK", // 输入地址，表示资金的来源地址。
      "witness": [] // 隔离见证（SegWit）数据，如果为空表示没有使用隔离见证。
    }
  ],
  "outputs": [
    {
      // outputs 部分列出了交易的资金去向。每个输出定义了新的UTXO。

      "address": "1GdK9UzpHBzqzX2A9JFP3Di4weBwqgmoQA", // 接收资金的地址
      "pkscript": "76a914ab68025513c3dbd2f7b92a94e0581f5d50f654e788ac", // 锁定脚本，定义了如何解锁这个输出
      "value": 1500000, // 转账金额：1500000 satoshi（0.015 BTC）。
      "spent": false, // 值为 false，说明这笔输出尚未被花费。
      "spender": null // 花费这个输出的交易ID。null表示尚未被花费。
    },
    {
      "address": "1Cdid9KFAaatwczBwBttQcwXYCpvK8h7FK",  // 找零地址（即发送方的地址）
      "pkscript": "76a9147f9b1a7fb68d60c536c2fd8aeaa53a8f3cc025a888ac",
      "value": 8450000, // 找零金额：8450000 satoshi（0.0845 BTC）。
      "spent": false,
      "spender": null
    }
  ],
  "block": {
    "height": 277316,   // 该交易所在区块的区块高度(即，在区块链中的位置)
    "position": 64      // 该交易在区块中的位置(即，索引)
  },
  "deleted": false,     // 交易是否被删除。false表示交易仍然有效。
  "time": 1388185914,   // 交易被打包进区块的时间戳，以Unix时间表示(2013-12-27 03:11:54 UTC)
  "rbf": false,         // 表示交易是否启用了RBF（替换交易费）功能。false表示未启用。
  "weight": 1032        // 交易的权重，用于计算交易在区块中的大小。隔离见证交易使用权重来计算费用。
}

补充：
    locktime：
        当值小于5亿，则被视为一个区块高度，即，交易只有在这个指定的区块高度之后才能被确认。
        当值大于等于5亿，则被视为Unix时间戳（自1970年1月1日以来的秒数），即，交易只能在指定的时间点之后被确认。

总览：
    这笔交易从一个地址（1Cdid9KFAaatwczBwBttQcwXYCpvK8h7FK）发送了1,500,000聪到另一个地址（1GdK9UzpHBzqzX2A9JFP3Di4weBwqgmoQA），并将剩余的8,450,000聪返回给自己。
    交易费为50,000聪。
    交易被打包在区块高度277316中，且尚未被花费。        
```

　

---------------------------------------------------------------------------------

　

### 交易示例 - 比特币协议中的原始交易格式(用于开发、调试和研究协议细节)
```
{
    "version": 1,   // 交易版本号
    "locktime": 0,  // 交易的时间锁
    "vin": [
        {
            "txid": "7957a35fe64f80d234d76d83a2a8f1a0d8149a41d81de548f0a65a8a999f6f18", // 上一笔交易的哈希值，表示这笔输入引用了该笔交易的输出。
            "vout": 0, // 上一笔交易中某个具体输出的索引号，此处是第 0 个输出。
            "scriptSig" : "3045022100884d142d86652a3f47ba4746ec719bbfbd040a570b1deccbb6498c75c4ae24cb02204b9f039ff08df09cbe9f6addac960298cad530a863ea8f53982c09db8f6e3813[ALL] 0484ecc0d46f1918b30928fa0e4ed99f16a0fb4fde0735e7ade8416ab9fe423cc5412336376789d172787ec3457eee41c04f4938de5cc17b4a10fa336a8d752adf",
            "sequence": 4294967295 // 序列号，值为 4294967295，表示未启用时间锁。
        }
    ],
    "vout": [
        {
            "value": 0.01500000, // 转账金额：0.015 BTC
            "scriptPubKey": "OP_DUP OP_HASH160 ab68025513c3dbd2f7b92a94e0581f5d50f654e7 OP_EQUALVERIFY OP_CHECKSIG" // 锁定脚本，用于锁定这笔 BTC 只能由目标地址所有者花费。
        },
        {
            "value": 0.08450000, // 找零金额：0.0845 BTC
            "scriptPubKey": "OP_DUP OP_HASH160 7f9b1a7fb68d60c536c2fd8aeaa53a8f3cc025a8 OP_EQUALVERIFY OP_CHECKSIG",
        }
    ]
}

补充：
    "txid": "7957a35fe64f80d234d76d83a2a8f1a0d8149a41d81de548f0a65a8a999f6f18"
        本次示例交易的输入部分，就来自于"7957a35fe64f80d234d76d83a2a8f1a0d8149a41d81de548f0a65a8a999f6f18"，内置了金额 0.1BTC。
        可以去比特币浏览器查看。

    "scriptSig" : "30450...db8f6e3813[ALL] 0484ecc...52adf"
        签名数据：30450...db8f6e3813[ALL]
        公钥：0484ecc...52adf

    "scriptPubKey": "OP_DUP OP_HASH160 ab68025513c3dbd2f7b92a94e0581f5d50f654e7 OP_EQUALVERIFY OP_CHECKSIG"
        这是 P2PKH（Pay-to-PubKey-Hash）脚本的一种标准形式：
            OP_DUP：复制栈顶的公钥。
            OP_HASH160：对公钥进行 RIPEMD-160(SHA256()) 哈希运算。
            ab68025513c3dbd2f7b92a94e0581f5d50f654e7：锁定的公钥哈希值。
            OP_EQUALVERIFY：检查两个栈顶值是否相等。
            OP_CHECKSIG：验证签名。
```

　

---------------------------------------------------------------------------------

　

### 其他与思考：
```
    比特币中的nonce，直译为"随机数"。

    比特币是基于UTX(Unspent Transaction Output，未花费交易输出)，而不是账户。

    双花攻击，必然需要51%攻击才能实施。

    比特币的稀缺性：
        固定总供应量，但不适合做货币
        因为，社会创造的价值在增加，货币量却没有增加，这个明显不符合"货币金融学"。

    量子计算机：
        比特币的有生之年，量子计算机的发展，恐怕无法达到如此境界。
        量子计算机首先威胁的是传统金融体系，因为加密货币的市值占比量，是无法与传统金融的市值比拟的。
```

　

---------------------------------------------------------------------------------

　

#### 比特币的单位：
```
Satoshi(最小的计量单位)              // 中本聪（Satoshi Nakamoto）是比特币的匿名创始人。
Microbitcoin (Bits) = 10^2 Satoshi  // 1 Bit = 100 Satoshis
Millibitcoin = 10^5 Satoshi         // 1 mBTC = 100,000 Satoshis
Centibitcoin = 10^6 Satoshi         // 1 cBTC = 1,000,000 Satoshis
Decibitcoin = 10^7 Satoshi          // 1 dBTC = 10,000,000 Satoshis
Bitcoin = 10^8 Satoshi              // 1 BTC = 100,000,000 Satoshis
```
