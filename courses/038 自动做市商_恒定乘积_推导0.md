
### 详细推导```function swap(address _tokenIn, uint256 _amountIn)```的数学计算
#### 基础数据介绍
- $x$，代表当前流动池现有的代币A
- $y$，代表当前流动池现有的代币B
- $△x$，代表用户放入进的代币A
- $△y$，代表用户拿出的代币B

　

------------------------------------------------------------------------------------------

　

#### 使用"默认恒定"公式，推导出△y的值
- $x·y = (x + △x)·(y - △y)$
-
- $x·y = x·y - x·△y + △x·y - △x·△y$
-
- $0 = 0 - x·△y + △x·y - △x·△y$
-
- $x·△y + △x·△y = △x·y$
-
- $△y·(x+△x) = △x·y$
-
- $△y = \frac{(△x · y)}{(x + △x)}$
-
- $△x = \frac{(△y · x)}{(y - △y)}$ 
-
- 用户支付的 $△x$​​ 的 ​​0.3%​​ 会被留在资金池中，剩下的 ​​99.7%​​ 才真正用于兑换。
-
- $△y = \frac{△x · (1 - 0.003) · y}{x + △x·(1 - 0.003)}$
-
- $△y = \frac{△x · (\frac{997}{1000}) · y}{x + △x·(\frac{997}{1000})}$
-
- $△y = \frac{△x · y · (\frac{997}{1000})}{x·(\frac{1000}{1000})  + △x·(\frac{997}{1000})}$
-
- $△y = \frac{△x · y · 997}{x · 1000 + △x · 997}$
-
- $一般不会用到：△x = \frac{(△y · x)· 1000}{(y - △y) · 997}$

#### 简化1
- 描述：用户向协议支付金额为△x，得到△y
- $x0·y0 = (x0 + △x)·(y0 - △y)$
- $△y = \frac{(y0·△x)}{(x0 + △x)}$

#### 简化2
- 描述：用户向协议卖出金额为△y，得到△x
- $x0·y0 = (x0 - △x)·(y0 + △y)$
- $△x = \frac{(x0·△y)}{(y0 + △y)}$
